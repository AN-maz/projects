<div class="comment-wrapper mb-2" id="comment-wrapper-<%= comment._id %>">
    <div class="d-flex" id="comment-<%= comment._id %>">
        <% if (comment.user) { %>
            <img src="/uploads/avatars/<%= comment.user.profilePicture %>" alt="Avatar" width="30" height="30" class="rounded-circle me-2 mt-1">
            <div class="bg-light p-2 rounded w-100">
                <a href="/profile/<%= comment.user.username %>" class="fw-bold text-dark text-decoration-none small"><%= comment.user.username %></a>
                <p class="mb-1 small">
                    <% if (comment.replyingTo) { %>
                        <a href="/profile/<%= comment.replyingTo.username %>" class="text-primary text-decoration-none fw-bold me-1">@<%= comment.replyingTo.username %></a>
                    <% } %>
                    <%= comment.content %>
                </p>
                <div class="d-flex align-items-center mt-1">
                    <a href="#" class="btn btn-link btn-sm text-decoration-none p-0 reply-btn" data-commentid="<%= comment._id %>">
                        <strong class="text-muted">Balas</strong>
                    </a>
                    <% if (user && comment.user && user._id.toString() === comment.user._id.toString()) { %>
                        <small class="text-muted mx-2">·</small>
                        <button class="btn btn-link btn-sm text-danger text-decoration-none p-0 delete-comment-btn" data-commentid="<%= comment._id %>">
                            <strong class="text-danger">Hapus</strong>
                        </button>
                    <% } %>
                </div>
            </div>
        <% } %>
    </div>

    <div class="ms-5 d-none reply-form-container" id="reply-form-<%= comment._id %>">
        <%- include('_replyForm', { user: user, post: post, parentComment: comment }) %>
    </div>

    <% if (comment.replies && comment.replies.length > 0) { %>
        <div class="replies-container ms-4 ps-3 border-start">
            <a href="#" class="btn btn-link btn-sm text-decoration-none p-0 fw-bold view-replies-btn">
                ─── Lihat <%= comment.replies.length %> balasan
            </a>
            <div class="replies-list d-none mt-2">
                <% comment.replies.forEach(reply => { %>
                    <%- include('_comment', { comment: reply, user: user, post: post }) %>
                <% }) %>
            </div>
        </div>
    <% } %>
</div>