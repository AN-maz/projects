<div class="d-flex mb-2" id="comment-<%= comment._id %>">
    <% if (comment.user) { %>
        <img src="/uploads/avatars/<%= comment.user.profilePicture %>" 
             alt="Avatar" width="30" height="30"
             class="rounded-circle me-2 mt-1">

        <div class="bg-white p-2 rounded w-100">
            <!-- Username -->
            <a href="/profile/<%= comment.user.username %>" 
               class="fw-bold text-dark text-decoration-none small">
                <%= comment.user.username %>
            </a>

            <!-- Isi komentar -->
            <p class="mb-1 small"><%= comment.content %></p>

            <!-- Aksi komentar -->
            <div class="d-flex align-items-center mt-1">
                <!-- Like komentar -->
                <form class="comment-like-form" method="POST" data-commentid="<%= comment._id %>">
                    <!-- Tombol like/unlike akan diisi via JS/Ajax -->
                </form>

                <small class="text-muted mx-2">Â·</small>

                <!-- Tombol reply -->
                <a href="#" class="btn btn-link btn-sm text-decoration-none p-0 reply-btn" 
                   data-commentid="<%= comment._id %>">
                    <strong class="text-muted">Balas</strong>
                </a>
            </div>
        </div>
    <% } %>
</div>

<!-- Nested replies -->
<div class="replies-container ms-5">
    <% if (comment.replies && comment.replies.length > 0) { %>
        <% comment.replies.forEach(reply => { %>
            <%- include('_comment', { comment: reply, user: user, post: post }) %>
        <% }) %>
    <% } %>
</div>

<!-- Form reply (default disembunyikan) -->
<div class="ms-5 d-none reply-form-container" id="reply-form-<%= comment._id %>">
    <form action="/posts/<%= post._id %>/comments" method="POST"
          class="d-flex align-items-center mt-2 comment-form"
          data-postid="<%= post._id %>" data-parentid="<%= comment._id %>">

        <input type="hidden" name="parentCommentId" value="<%= comment._id %>">

        <img src="/uploads/avatars/<%= user.profilePicture %>" 
             alt="Avatar" width="30" height="30" class="rounded-circle me-2">

        <input type="text" name="content" 
               class="form-control form-control-sm" 
               placeholder="Tulis balasan..." required>

        <button type="submit" class="btn btn-sm btn-primary ms-2">Kirim</button>
    </form>
</div>
